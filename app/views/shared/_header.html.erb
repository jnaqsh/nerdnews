<% unread_messages = current_user.count_unread_messages if current_user %>
<div class="navbar-inner">

  <div class="container">

    <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </a>

    <%= link_to root_path do %>
      <%= image_tag 'NerdLogo-58px.png', class: 'logo pull-right', title: t('.brand_name') %>
    <% end %>

    <!-- User Buttton -->
    <% unless current_user %>

    <div class="pull-left">
      <ul class="nav">
          <li><%= link_to t('.register'), register_path %></li>
          <li><%= link_to t('.login'), login_path %></li>
      </ul>
    </div>

    <% else %>
      <div class="btn-group pull-left">
        <a class="btn dropdown-toggle" data-toggle="dropdown" id="user-menu" href="<%= user_path(current_user) %>">
          <%= image_tag avatar_url(current_user) %>
          <%= current_user.full_name %>
          <% if unread_messages > 0 %>
            <span class="label label-important"><%= unread_messages.to_farsi %></span>
          <% end %>
          <span class="caret"></span>
        </a>
        <ul class="dropdown-menu">

          <li><%= link_to t('.profile'), user_path(current_user) %></li>

          <li class="divider"></li>

          <% if can? :publish, Story %>
            <li><%= link_to t('.unpublished_stories'), unpublished_stories_path %></li>
          <% end %>

          <% if can? :create, Tag %>
            <li><%= link_to t('.tags'), tags_path %></li>
          <% end %>

          <% if can? :index, User %>
            <li><%= link_to t('.users'), users_path %></li>
          <% end %>

          <% if can? :create, Rating %>
            <li><%= link_to t('.ratings'), ratings_path %></li>
          <% end %>

          <% if can? :create, Message %>
            <li>
              <%= link_to user_messages_path(current_user) do %>
                <%= t('.messages') %>
                <% if unread_messages > 0 %>
                  <span class="label label-important">
                    <%= unread_messages.to_farsi %>
                  </span>
                <% end %>
              <% end %>
            </li>
          <% end %>

            <% if can? :index, Identity %>
              <li><%= link_to t('.identities'), identities_path %></li>
            <% end %>

            <li class="divider"></li>
          <li><%= link_to t('.logout'), logout_path, method: :post,
            data: {confirm: t("helpers.links.confirm")} %></li>
        </ul>
      </div>
    <% end %>

    <!-- Links -->
    <div class="nav-collapse">
      <ul class="nav">
        <%= link_to_li t('.home'), root_path %>
        <% if can? :index, :mypage %>
          <%= link_to_li t('.mypage'), mypage_index_path, style: 'font-weight: bold' %>
        <% end %>
        <%= link_to_li t('.new_story'), new_story_path %><!--
        <li><%#= link_to t('.about'), page_by_permalink_path("about-us") %></li>
        <li><%#= link_to t('.contact us'), root_path %></li>-->
        <%= form_tag stories_path, method: :get, class: "navbar-search pull-left" do %>
          <%= text_field_tag :search, params[:search], class: "span2 search-query",
            placeholder: t(".search") %>
        <% end %>
      </ul>
    </div>
  </div>
</div>
